<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>像素风刮刮乐</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background-color: #ffe6f2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #ff66b2;
            text-shadow: 3px 3px 0 #ff99cc;
            margin-bottom: 30px;
            letter-spacing: 2px;
        }
        
        .card-container {
            position: relative;
            width: 300px;
            height: 200px;
            margin: 0 auto 30px;
            border: 4px solid #ff66b2;
            border-radius: 10px;
            background-color: white;
            box-shadow: 5px 5px 0 #ff99cc;
            overflow: hidden;
        }
        
        .card {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: #66ccff;
            background-color: white;
            border-radius: 6px;
            position: relative;
        }
        
        .result {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            font-size: 2.5rem;
            font-weight: bold;
            color: #66ccff;
            text-shadow: 2px 2px 0 #aaddff;
            background-color: white;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        .scratch-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #cccccc;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="%23ff66b2"/></svg>') 12 12, auto;
            border-radius: 6px;
            z-index: 2;
        }
        
        .button {
            background-color: #ff66b2;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 3px 3px 0 #ff99cc;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
        }
        
        .button:hover {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 #ff99cc;
        }
        
        .button:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }
        
        .progress-bar {
            width: 300px;
            height: 10px;
            background-color: #ffccdd;
            border-radius: 5px;
            margin: 10px auto;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #ff66b2;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>刮刮乐</h1>
        
        <div class="card-container">
            <div class="card">
                <div class="result" id="result">刮开查看结果</div>
                <div class="scratch-area" id="scratchArea"></div>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        
        <button class="button" id="playAgain">再来一次</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scratchArea = document.getElementById('scratchArea');
            const result = document.getElementById('result');
            const playAgainButton = document.getElementById('playAgain');
            const progress = document.getElementById('progress');
            
            // 可能的奖项
            const prizes = [
                { value: 10, text: '10元' },
                { value: 20, text: '20元' },
                { value: 50, text: '50元' },
                { value: 100, text: '100元' },
                { value: 200, text: '200元' },
                { value: 500, text: '500元' },
                { value: 1000, text: '1000元' },
                { value: 2000, text: '2000元' },
                { value: 3000, text: '3000元' },
                { value: 4000, text: '4000元' },
                { value: 5000, text: '5000元' },
                { value: 10000, text: '1万' },
                { value: 20000, text: '2万' },
                { value: 50000, text: '5万' },
                { value: 100000, text: '10万' },
                { value: 200000, text: '20万' },
                { value: 500000, text: '50万' },
                { value: 1000000, text: '100万' },
                { value: 2000000, text: '200万' },
                { value: 3000000, text: '300万' },
                { value: 4000000, text: '400万' },
                { value: 5000000, text: '500万' }
            ];
            
            // 当前奖项
            let currentPrize = null;
            let canvas, ctx;
            let isScratched = false;
            
            // 初始化刮刮乐
            function initScratchCard() {
                isScratched = false;
                progress.style.width = '0%';
                
                // 生成随机奖项
                generatePrize();
                
                // 设置结果文本
                result.textContent = currentPrize.text;
                
                // 根据奖项值设置不同颜色
                if (currentPrize.value === 0) {
                    result.style.color = "#ff66b2"; // 再来一次用粉色
                } else if (currentPrize.value >= 10000) {
                    result.style.color = "#ff3399"; // 大奖用深粉色
                } else {
                    result.style.color = "#66ccff"; // 普通奖用淡蓝色
                }
                
                // 清除之前的canvas
                const existingCanvas = scratchArea.querySelector('canvas');
                if (existingCanvas) {
                    scratchArea.removeChild(existingCanvas);
                }
                
                // 创建canvas用于刮刮乐效果
                canvas = document.createElement('canvas');
                ctx = canvas.getContext('2d');
                canvas.width = scratchArea.offsetWidth;
                canvas.height = scratchArea.offsetHeight;
                scratchArea.appendChild(canvas);
                
                // 绘制刮刮乐覆盖层
                ctx.fillStyle = '#cccccc';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#ff99cc';
                ctx.font = '16px "Courier New", monospace';
                ctx.textAlign = 'center';
                ctx.fillText('刮开此处', canvas.width/2, canvas.height/2);
                
                // 设置刮刮乐交互
                setupScratchEvents();
            }
            
            // 设置刮刮乐事件
            function setupScratchEvents() {
                let isDrawing = false;
                
                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('touchstart', startDrawing);
                
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('touchmove', draw);
                
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('touchend', stopDrawing);
                
                function startDrawing(e) {
                    isDrawing = true;
                    draw(e);
                    e.preventDefault();
                }
                
                function draw(e) {
                    if (!isDrawing || isScratched) return;
                    
                    // 获取鼠标/触摸位置
                    const rect = canvas.getBoundingClientRect();
                    let x, y;
                    
                    if (e.type.includes('mouse')) {
                        x = e.clientX - rect.left;
                        y = e.clientY - rect.top;
                    } else {
                        x = e.touches[0].clientX - rect.left;
                        y = e.touches[0].clientY - rect.top;
                        e.preventDefault();
                    }
                    
                    // 清除圆形区域
                    ctx.globalCompositeOperation = 'destination-out';
                    ctx.beginPath();
                    ctx.arc(x, y, 15, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // 检查刮开区域是否超过50%
                    checkScratchedArea();
                }
                
                function stopDrawing() {
                    isDrawing = false;
                }
            }
            
            // 检查刮开区域
            function checkScratchedArea() {
                // 获取图像数据
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const pixels = imageData.data;
                let transparentPixels = 0;
                
                // 计算透明像素数量
                for (let i = 3; i < pixels.length; i += 4) {
                    if (pixels[i] === 0) {
                        transparentPixels++;
                    }
                }
                
                // 计算刮开比例并更新进度条
                const totalPixels = pixels.length / 4;
                const scratchedPercent = (transparentPixels / totalPixels) * 100;
                progress.style.width = scratchedPercent + '%';
                
                // 如果超过50%区域被刮开，显示结果
                if (scratchedPercent > 50 && !isScratched) {
                    isScratched = true;
                    // 添加动画效果
                    scratchArea.style.transition = 'opacity 0.5s';
                    scratchArea.style.opacity = '0';
                    
                    setTimeout(() => {
                        scratchArea.style.display = 'none';
                    }, 500);
                }
            }
            
            // 生成随机奖项
            function generatePrize() {
                const randomValue = Math.random();
                
                // 90%概率为"再来一次"
                if (randomValue < 0.9) {
                    currentPrize = { value: 0, text: "再来一次" };
                } else {
                    // 10%概率为中奖
                    let prize;
                    
                    // 对于超过500的奖项，概率减少80%
                    if (Math.random() < 0.2) {
                        // 从所有奖项中随机选择
                        prize = prizes[Math.floor(Math.random() * prizes.length)];
                    } else {
                        // 只选择500及以下的奖项
                        const smallPrizes = prizes.filter(p => p.value <= 500);
                        prize = smallPrizes[Math.floor(Math.random() * smallPrizes.length)];
                    }
                    
                    currentPrize = prize;
                }
            }
            
            // 初始化游戏
            initScratchCard();
            
            // 再来一次按钮事件
            playAgainButton.addEventListener('click', function() {
                // 重置刮刮乐区域
                scratchArea.style.display = 'block';
                scratchArea.style.opacity = '1';
                initScratchCard();
            });
        });
    </script>
</body>
</html>